<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Test Workflow — n8n + GitHub Pages</title>
  <style>
    :root { color-scheme: light dark; }
    body {
      margin:0; min-height:100dvh; display:grid; place-items:center;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
      background: #0b0d10; color: #e8eef5;
    }
    .card {
      width:min(680px, 92vw); padding:28px; border-radius:20px;
      background:#12161b; box-shadow:0 10px 30px rgba(0,0,0,.4);
      display:flex; flex-direction:column; gap:16px; text-align:center;
    }
    h1 { margin:0; font-size:clamp(20px, 3.2vw, 28px); }
    p  { margin:0; opacity:.9 }
    button {
      all:unset; cursor:pointer; align-self:center; padding:14px 22px;
      border-radius:14px; font-weight:700; font-size:16px;
      background: linear-gradient(135deg, #6f7bf7, #8b5cf6, #14b8a6);
      color:white; box-shadow:0 6px 20px rgba(79,70,229,.35);
      transition: transform .08s ease, filter .15s ease;
    }
    button:hover { filter:brightness(1.08); }
    button:active { transform: translateY(1px) scale(.99); }
    button[disabled] { filter:grayscale(.5) brightness(.7); cursor:not-allowed; }
    .out {
      font: 12px/1.4 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      text-align:left; white-space:pre-wrap; background:#0c1116; color:#cbe4ff;
      padding:14px; border-radius:12px; max-height:40vh; overflow:auto;
      border:1px solid rgba(255,255,255,.06);
    }
  </style>
</head>
<body>
  <main class="card">
    <h1>Probar n8n desde GitHub Pages</h1>
    <p>Al presionar, se dispara el workflow en n8n vía Webhook.</p>

    <button id="btn" type="button">Test Workflow</button>
    <div id="out" class="out" aria-live="polite">Listo para disparar…</div>
  </main>

  <script>
    // === CONFIGURACIÓN ===
    const WEBHOOK_URL = "https://trusting-splendid-gannet.ngrok.app/webhook-test/test-workflow-123abc"; // <— Reemplazar

    // (Opcional) Cabeceras extra si tu webhook espera algo específico
    const EXTRA_HEADERS = {
      // 'Authorization': 'Basic <base64(user:pass)>',  // NO recomendado en front público
    };

    async function runWorkflow() {
      const btn = document.getElementById('btn');
      const out = document.getElementById('out');
      btn.disabled = true;
      out.textContent = 'Disparando workflow…';

      try {
        const res = await fetch(WEBHOOK_URL, {
          method: 'POST',
          mode: 'cors',
          cache: 'no-store',
          headers: { 'Content-Type': 'application/json', ...EXTRA_HEADERS },
          body: JSON.stringify({
            source: 'github-pages',
            timestamp: new Date().toISOString()
          })
        });

        const isJson = (res.headers.get('content-type') || '').includes('application/json');
        const payload = isJson ? await res.json() : await res.text();

        if (!res.ok) {
          throw new Error(typeof payload === 'string' ? payload : JSON.stringify(payload));
        }
        out.textContent = 'OK ✅\n\nRespuesta del webhook:\n' +
          (isJson ? JSON.stringify(payload, null, 2) : payload);
      } catch (err) {
        console.error(err);
        out.textContent = 'Error ❌\n' + (err && err.message ? err.message : String(err));
      } finally {
        btn.disabled = false;
      }
    }

    document.getElementById('btn').addEventListener('click', runWorkflow);
  </script>
</body>
</html>
